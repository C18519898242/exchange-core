# 运维操作手册

本文档为运维人员提供 `exchange-core` 服务的启动和维护指南。

## 服务启动

核心交易引擎通过 `ExchangeCoreStarter` 类启动。这是一个标准的 Java 应用程序。

### 启动命令

在项目的根目录下，使用以下命令来编译和运行服务：

```bash
# 编译项目
mvn clean install

# 运行服务
java -jar target/exchange-core-*.jar
```

*注意：请将 `exchange-core-*.jar` 替换为 `target` 目录下实际生成的 JAR 文件名。*

### 启动模式

服务启动时，会要求操作员选择一种启动模式：

1.  **冷启动 (Cold Start)**:
    *   **描述**: 从一个完全干净的状态启动。所有历史数据、用户账户、订单等都将被清空。
    *   **操作**: 在提示 `Enter your choice (1 or 2):` 后，输入 `1` 并按回车。
    *   **适用场景**:
        *   首次部署服务。
        *   测试环境重置。
        *   发生严重数据损坏，无法通过热启动恢复时。

2.  **热启动 (Hot Start)**:
    *   **描述**: 从最近的快照 (snapshot) 和日志 (journal) 中恢复数据，以继续之前的交易状态。
    *   **操作**:
        1.  在提示 `Enter your choice (1 or 2):` 后，输入 `2` 并按回车。
        2.  在提示 `Please enter snapshotId:` 后，输入要恢复的快照ID。
        3.  在提示 `Please enter baseSeq:` 后，输入对应的基础序列号。
    *   **适用场景**:
        *   日常的服务重启或升级。
        *   从计划内或计划外的停机中恢复。
    *   **重要提示**: `snapshotId` 和 `baseSeq` 必须是匹配的，并且是基于 `dumps` 目录下的有效快照文件。输入错误的值可能导致启动失败或数据不一致。

## 服务停止

服务可以通过 `Ctrl+C` 来停止。

程序内部注册了 `ShutdownHook`，这意味着当收到终止信号时，它会尝试优雅地关闭 `ExchangeCore` 引擎，确保所有内存中的数据都被正确处理，并关闭相关资源，以避免数据损坏。

## 日志和数据

*   **日志文件**: 服务的运行日志通常配置在 `logback.xml` 中，默认会输出到控制台和/或日志文件中。请检查该文件以获取确切的日志路径。
*   **数据文件**: 交易快照和日志默认存储在项目根目录下的 `dumps` 文件夹中。请务必定期备份此文件夹。
